
#include "cube_animations.h"


static animation *crrnt_animation;
static int crrnt_frame = 0;
static int animation_go = 0;


ISR (TIMER1_COMPA_vect)
{
	static int loop_counter = 0;
	if(animation_go){
		if(++crrnt_frame >= crrnt_animation->length){
			crrnt_frame = 0;
			loop_counter ++;
			if(crrnt_animation->loop == loop_counter){
				crrnt_animation = crrnt_animation->next;
				loop_counter = 0;
			}	
			
		}
		led_matrix_framebffr = crrnt_animation->data+crrnt_frame*sizeof(int8_t)*FRAME_SIZE;
	}
}


void animation_init(){
	animation_go = 0;
	 // CTC Modus
  	TCCR1B |= (1<<WGM12)|(1<<CS12)|(1<<CS10); // Prescaler 1024
	OCR1A = 410;//410;// 19 frames per second!!!   ((1/19)/(1/8000000))/1024;   //  (TimeToGet/(1/F_CPU))/PRESCALER == to write in OCR0A
 	
  	// Compare Interrupt erlauben
  	TIMSK |= (1<<OCIE1A);
}



void set_animation(animation * new_animation){
	crrnt_animation = new_animation;
	led_matrix_framebffr = crrnt_animation->data;
	crrnt_frame = 0;	
	animation_go = 1;
}









int8_t animation01[8][FRAME_SIZE] = {
					{0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00},
					{0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00},
					{0xFF,0xFF,0xFF,0xFF,0xff,0xFF,0x00,0x00},
					{0xFF,0xFF,0xFF,0xFF,0xff,0xFF,0xFF,0xFF},
					{0xFF,0xFF,0xFF,0xFF,0xff,0xFF,0x00,0x00},
					{0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00},
					{0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00},
					{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}
					
};

int8_t animation02[8][FRAME_SIZE] = {
					{0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF},
					{0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF},
					{0xFF,0xFF,0xFF,0xFF,0xff,0xFF,0x00,0x00},
					{0xFF,0xFF,0xFF,0xFF,0xff,0xFF,0xFF,0xFF},
					{0xFF,0xFF,0xFF,0xFF,0xff,0xFF,0x00,0x00},
					{0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF},
					{0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF},
					{0x00,0x00,0xFF,0xFF,0xFF,0x00,0xFF,0xFF}
					
};

int8_t animation03[7][FRAME_SIZE] = {
					{0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00},
					{0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00},
					{0x00,0x00,0x00,0x00,0xff,0xff,0x00,0x00},
					{0x00,0x00,0x00,0x00,0x00,0x00,0xff,0xFF},
					{0x00,0x00,0x00,0x00,0xff,0xff,0x00,0x00},
					{0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00},
					{0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00},
};
